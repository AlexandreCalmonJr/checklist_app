<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#3b82f6" />
  <meta name="description" content="Aplicativo para gest√£o de checklists hospitalares com suporte offline" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Checklist" />

  <title>Checklist Hospitalar</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%233b82f6' width='192' height='192'/><text x='50%' y='50%' font-size='100' fill='white' text-anchor='middle' dominant-baseline='central' font-weight='bold'>‚úì</text></svg>" />

  <!-- Design System CSS -->
  <link rel="stylesheet" href="styles.css">

  <!-- jsPDF Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
  <div class="container">
    <!-- Header Card -->
    <div class="card animate-fade-in">
      <div class="card-header">
        <div class="flex flex-center gap-md">
          <img src="logo.png" alt="Logo do Hospital" style="width: 160px; height: auto;">
          <div>
            <h1
              style="margin: 0; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
              Checklist Hospitalar
            </h1>
            <p class="text-muted" style="margin: 0; font-size: var(--font-size-sm);">
              <span id="unidadeNomeHeader"></span>
            </p>
          </div>
        </div>
        <!-- Link para √Årea Administrativa -->
        <a href="config.html" class="btn-admin-link" title="√Årea Administrativa" style="display: flex; align-items: center; gap: 6px; padding: 8px 12px; 
                  background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3);
                  border-radius: 8px; color: var(--color-primary, #667eea); text-decoration: none;
                  font-size: 0.85rem; transition: all 0.2s ease;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
          </svg>
          Admin
        </a>
      </div>

      <!-- Progress Bar -->
      <div id="progressContainer" class="progress-container hidden">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-text">
          <span id="progressText">0% conclu√≠do</span>
        </div>
      </div>

      <!-- Main Form -->
      <form id="checklistForm" class="card-body">
        <!-- Sele√ß√£o de Unidade -->
        <fieldset class="fieldset animate-slide-up">
          <legend class="fieldset-legend">üè• Selecionar Unidade</legend>

          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label" for="unidade">Unidade</label>
              <select id="unidade" required class="form-select">
                <option value="">Selecione a Unidade</option>
              </select>
            </div>
          </div>
        </fieldset>

        <!-- Dados do Checklist -->
        <fieldset class="fieldset animate-slide-up">
          <legend class="fieldset-legend">üìã Dados do Checklist</legend>

          <div class="grid grid-2">
            <div class="form-group">
              <label class="form-label" for="tipoChecklist">Tipo de Checklist</label>
              <select id="tipoChecklist" required class="form-select">
                <option value="">Selecione o Tipo</option>
                <option value="centroCirurgico">Centro Cir√∫rgico</option>
                <option value="racks">Racks</option>
                <option value="emergencia">Emerg√™ncia</option>
                <option value="totensepaineis">Totens e Paineis</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="dataCheck">Data do Checklist</label>
              <input type="date" id="dataCheck" required class="form-input" />
            </div>

            <div class="form-group">
              <label class="form-label" for="nomeTecnico">Nome do T√©cnico</label>
              <select id="nomeTecnico" required class="form-select">
                <option value="">Selecione o T√©cnico</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="numeroChamado">N√∫mero do Chamado</label>
              <input type="text" id="numeroChamado" required placeholder="Ex: 12345" class="form-input" />
            </div>

            <div class="form-group">
              <label class="form-label" for="setor">Setor</label>
              <select id="setor" required class="form-select">
                <option value="">Selecione o Setor</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="local">Local</label>
              <select id="local" required class="form-select">
                <option value="">Selecione o Local</option>
              </select>
            </div>
          </div>
        </fieldset>

        <!-- Respons√°vel Info - Melhorado -->
        <div id="responsavelDiv" class="hidden" style="margin-top: var(--space-lg); margin-bottom: var(--space-lg);">
          <div style="
            padding: var(--space-lg);
            background: linear-gradient(135deg, #3b82f6 0%, #7c3aed 100%);
            border-radius: var(--radius-xl);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            color: white;
            display: flex;
            align-items: center;
            gap: var(--space-md);
          ">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <div>
              <p
                style="margin: 0; font-size: var(--font-size-xs); opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px;">
                Respons√°vel pela √Årea
              </p>
              <p style="margin: 0; font-size: var(--font-size-lg); font-weight: 600;" id="responsavelNome"></p>
            </div>
          </div>
        </div>

        <!-- Itens do Checklist - Melhorado -->
        <div id="itensChecklistContainer" class="hidden"
          style="margin-top: var(--space-lg); margin-bottom: var(--space-lg);">
          <div style="
            border: 2px solid var(--color-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
          ">
            <h3 style="
              margin: 0 0 var(--space-lg) 0;
              color: var(--color-primary);
              font-size: var(--font-size-lg);
              display: flex;
              align-items: center;
              gap: var(--space-sm);
            ">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
              </svg>
              Itens de Verifica√ß√£o
            </h3>
            <div id="itensChecklist" style="display: grid; gap: var(--space-lg);"></div>
          </div>
        </div>

        <!-- Observa√ß√µes -->
        <div class="form-group" style="margin-top: var(--space-lg); margin-bottom: var(--space-lg);">
          <label class="form-label" for="observacoes">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              style="vertical-align: middle; margin-right: 8px;">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>
            Observa√ß√µes
          </label>
          <textarea id="observacoes" class="form-input" rows="4"
            placeholder="Adicione observa√ß√µes importantes..."></textarea>
        </div>
        <div class="flex flex-wrap gap-md" style="justify-content: center; margin-top: var(--space-xl);">
          <button type="button" id="salvarSalaBtn" class="btn btn-primary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 2H3a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V5l-3-3z" />
              <polyline points="9 13 9 7 11 7 11 13" />
              <polyline points="5 13 9 17 13 13" />
            </svg>
            Salvar Sala
          </button>

          <button type="button" id="proximaSalaBtn" class="btn btn-success">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6" />
            </svg>
            Pr√≥xima Sala
          </button>

          <button type="button" id="finalizarChecklistBtn" class="btn btn-secondary">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11l3 3L22 4" />
              <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            </svg>
            Revisar e Assinar
          </button>

          <button type="button" id="resetarChecklist" class="btn btn-danger">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="1 4 1 10 7 10" />
              <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
            </svg>
            Resetar
          </button>
        </div>

        <!-- Salas Visitadas -->
        <div id="listaSalasVisitadas" class="mt-xl"
          style="padding-top: var(--space-lg); border-top: 2px solid var(--color-border);">
          <h3
            style="font-size: var(--font-size-lg); margin-bottom: var(--space-md); color: var(--color-text-secondary);">
            üìã Salas Visitadas
          </h3>
          <div id="salasVisitadasList" class="flex flex-wrap gap-sm">
            <!-- Badges ser√£o inseridos aqui -->
          </div>
        </div>
      </form>

      <!-- Painel de Assinaturas -->
      <div id="painelAssinaturas" class="hidden mt-xl">
        <h2 class="text-center mb-lg"
          style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          ‚úçÔ∏è Assinaturas dos Respons√°veis
        </h2>
        <div id="assinaturasContainer" class="grid gap-lg">
          <!-- Blocos de assinatura ser√£o inseridos aqui -->
        </div>
      </div>

      <!-- Bot√£o Gerar PDF -->
      <div id="painelGerarPDF" class="hidden text-center mt-xl">
        <button type="button" id="gerarPDF" class="btn btn-primary btn-lg">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
          Gerar PDF Final com Todas as Assinaturas
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="app.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('‚úÖ Service Worker registrado com sucesso!', registration);

            // Verificar atualiza√ß√µes periodicamente
            setInterval(() => {
              registration.update();
            }, 60000); // Verificar a cada 60 segundos
          })
          .catch(error => {
            console.error('‚ùå Erro ao registrar Service Worker:', error);
          });
      });

      // Notificar quando h√° atualiza√ß√£o dispon√≠vel
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        console.log('üì¶ Aplicativo atualizado! Recarregue para usar a nova vers√£o.');
      });
    }

    // Detectar se est√° sendo executado como PWA
    let displayMode = 'browser';
    if (navigator.standalone === true) {
      displayMode = 'standalone';
    } else if (window.matchMedia('(display-mode: standalone)').matches) {
      displayMode = 'standalone';
    }
    console.log(`üì± Modo de exibi√ß√£o: ${displayMode}`);
  </script>
</body>

</html>